<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Adventures in MacroFinancial Analysis: Extracting information from FX Options</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Adventures in MacroFinancial Analysis: Extracting information from FX Options" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Adventures in MacroFinancial Analysis: Extracting information from FX Options" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Jorge A. Chan-Lau">


<meta name="date" content="2018-01-10">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="3-3-curvature.html">
<link rel="next" href="4-extracting-the-risk-neutral-density.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="1-intro.html"><a href="1-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="1-1-Data-exploration.html"><a href="1-1-Data-exploration.html"><i class="fa fa-check"></i><b>1.1</b> Examining the data</a></li>
<li class="chapter" data-level="1.2" data-path="1-2-spot-exchange-rate.html"><a href="1-2-spot-exchange-rate.html"><i class="fa fa-check"></i><b>1.2</b> Spot exchange rate</a></li>
<li class="chapter" data-level="1.3" data-path="1-3-implied-and-actual-usd-rates.html"><a href="1-3-implied-and-actual-usd-rates.html"><i class="fa fa-check"></i><b>1.3</b> Implied and actual USD rates</a></li>
<li class="chapter" data-level="1.4" data-path="1-4-atm-option-volatility.html"><a href="1-4-atm-option-volatility.html"><i class="fa fa-check"></i><b>1.4</b> ATM option volatility</a></li>
<li class="chapter" data-level="1.5" data-path="1-5-risk-reversals.html"><a href="1-5-risk-reversals.html"><i class="fa fa-check"></i><b>1.5</b> Risk Reversals</a></li>
<li class="chapter" data-level="1.6" data-path="1-6-butterfly-spreads.html"><a href="1-6-butterfly-spreads.html"><i class="fa fa-check"></i><b>1.6</b> Butterfly spreads</a></li>
<li class="chapter" data-level="1.7" data-path="1-7-original-file.html"><a href="1-7-original-file.html"><i class="fa fa-check"></i><b>1.7</b> Original file</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-a-modicum-of-option-pricing-theory.html"><a href="2-a-modicum-of-option-pricing-theory.html"><i class="fa fa-check"></i><b>2</b> A modicum of option pricing theory</a><ul>
<li class="chapter" data-level="2.1" data-path="2-1-the-delta-of-an-option.html"><a href="2-1-the-delta-of-an-option.html"><i class="fa fa-check"></i><b>2.1</b> The <span class="math inline">\(\Delta\)</span> of an option</a><ul>
<li><a href="2-1-the-delta-of-an-option.html#box-1.-delta-and-dynamic-replication">Box 1. <span class="math inline">\(\Delta\)</span> and dynamic replication</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="2-2-pricing-foreign-currency-options.html"><a href="2-2-pricing-foreign-currency-options.html"><i class="fa fa-check"></i><b>2.2</b> Pricing foreign currency options</a><ul>
<li class="chapter" data-level="2.2.1" data-path="2-2-pricing-foreign-currency-options.html"><a href="2-2-pricing-foreign-currency-options.html#replicating-the-cost-of-a-call-option"><i class="fa fa-check"></i><b>2.2.1</b> Replicating the cost of a call option</a></li>
<li class="chapter" data-level="2.2.2" data-path="2-2-pricing-foreign-currency-options.html"><a href="2-2-pricing-foreign-currency-options.html#the-garman-kohlhagen-equation"><i class="fa fa-check"></i><b>2.2.2</b> The Garman-Kohlhagen equation</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="2-3-pricing-conventions.html"><a href="2-3-pricing-conventions.html"><i class="fa fa-check"></i><b>2.3</b> Pricing conventions</a><ul>
<li class="chapter" data-level="2.3.1" data-path="2-3-pricing-conventions.html"><a href="2-3-pricing-conventions.html#delta-implied-strikes"><i class="fa fa-check"></i><b>2.3.1</b> <span class="math inline">\(\Delta\)</span>-implied strikes</a></li>
<li class="chapter" data-level="2.3.2" data-path="2-3-pricing-conventions.html"><a href="2-3-pricing-conventions.html#implied-volatility"><i class="fa fa-check"></i><b>2.3.2</b> Implied volatility</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-the-volatility-smile.html"><a href="3-the-volatility-smile.html"><i class="fa fa-check"></i><b>3</b> The volatility smile</a><ul>
<li class="chapter" data-level="" data-path="3-the-volatility-smile.html"><a href="3-the-volatility-smile.html#box-2.-put-call-parity"><i class="fa fa-check"></i>Box 2. Put-call parity</a></li>
<li class="chapter" data-level="3.1" data-path="3-1-level.html"><a href="3-1-level.html"><i class="fa fa-check"></i><b>3.1</b> Level</a></li>
<li class="chapter" data-level="3.2" data-path="3-2-slope.html"><a href="3-2-slope.html"><i class="fa fa-check"></i><b>3.2</b> Slope</a></li>
<li class="chapter" data-level="3.3" data-path="3-3-curvature.html"><a href="3-3-curvature.html"><i class="fa fa-check"></i><b>3.3</b> Curvature</a></li>
<li class="chapter" data-level="3.4" data-path="3-4-constructing-the-volatility-smile.html"><a href="3-4-constructing-the-volatility-smile.html"><i class="fa fa-check"></i><b>3.4</b> Constructing the volatility smile</a><ul>
<li class="chapter" data-level="3.4.1" data-path="3-4-constructing-the-volatility-smile.html"><a href="3-4-constructing-the-volatility-smile.html#selecting-the-data-for-specific-dates"><i class="fa fa-check"></i><b>3.4.1</b> Selecting the data for specific dates</a></li>
<li class="chapter" data-level="3.4.2" data-path="3-4-constructing-the-volatility-smile.html"><a href="3-4-constructing-the-volatility-smile.html#calculation-of-implied-volatilities-vols"><i class="fa fa-check"></i><b>3.4.2</b> Calculation of implied volatilities (vols)</a></li>
<li class="chapter" data-level="3.4.3" data-path="3-4-constructing-the-volatility-smile.html"><a href="3-4-constructing-the-volatility-smile.html#delta_atm-depends-on-the-atm-conventions-used"><i class="fa fa-check"></i><b>3.4.3</b> <span class="math inline">\(\Delta_{ATM}\)</span> depends on the ATM conventions used</a></li>
<li class="chapter" data-level="3.4.4" data-path="3-4-constructing-the-volatility-smile.html"><a href="3-4-constructing-the-volatility-smile.html#a-rough-first-pass-on-the-volatility-smile"><i class="fa fa-check"></i><b>3.4.4</b> A rough first pass on the volatility smile</a></li>
<li class="chapter" data-level="3.4.5" data-path="3-4-constructing-the-volatility-smile.html"><a href="3-4-constructing-the-volatility-smile.html#a-more-refined-approximation-of-the-volatility-smile"><i class="fa fa-check"></i><b>3.4.5</b> A more refined approximation of the volatility smile</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-extracting-the-risk-neutral-density.html"><a href="4-extracting-the-risk-neutral-density.html"><i class="fa fa-check"></i><b>4</b> Extracting the risk-neutral density</a><ul>
<li class="chapter" data-level="4.1" data-path="4-1-extraction-techniques.html"><a href="4-1-extraction-techniques.html"><i class="fa fa-check"></i><b>4.1</b> Extraction techniques</a></li>
<li class="chapter" data-level="4.2" data-path="4-2-infering-premia-and-strike-prices-from-the-volatility-smile.html"><a href="4-2-infering-premia-and-strike-prices-from-the-volatility-smile.html"><i class="fa fa-check"></i><b>4.2</b> Infering premia and strike prices from the volatility smile</a></li>
<li class="chapter" data-level="4.3" data-path="4-3-the-call-option-case.html"><a href="4-3-the-call-option-case.html"><i class="fa fa-check"></i><b>4.3</b> The call option case</a></li>
<li class="chapter" data-level="4.4" data-path="4-4-the-put-option-case.html"><a href="4-4-the-put-option-case.html"><i class="fa fa-check"></i><b>4.4</b> The put option case</a></li>
<li class="chapter" data-level="4.5" data-path="4-5-practical-implementation.html"><a href="4-5-practical-implementation.html"><i class="fa fa-check"></i><b>4.5</b> Practical Implementation</a></li>
<li class="chapter" data-level="4.6" data-path="4-6-generalized-beta-distribution14.html"><a href="4-6-generalized-beta-distribution14.html"><i class="fa fa-check"></i><b>4.6</b> Generalized beta distribution[^14]</a></li>
<li class="chapter" data-level="4.7" data-path="4-7-edgeworth-expansion.html"><a href="4-7-edgeworth-expansion.html"><i class="fa fa-check"></i><b>4.7</b> Edgeworth expansion</a></li>
<li class="chapter" data-level="4.8" data-path="4-8-shimko-method16.html"><a href="4-8-shimko-method16.html"><i class="fa fa-check"></i><b>4.8</b> Shimko method[^16]</a></li>
<li class="chapter" data-level="4.9" data-path="4-9-a-graphical-comparison-of-different-methods.html"><a href="4-9-a-graphical-comparison-of-different-methods.html"><i class="fa fa-check"></i><b>4.9</b> A graphical comparison of different methods</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-final-words.html"><a href="5-final-words.html"><i class="fa fa-check"></i><b>5</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Adventures in MacroFinancial Analysis: Extracting information from FX Options</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="constructing-the-volatility-smile" class="section level2">
<h2><span class="header-section-number">3.4</span> Constructing the volatility smile</h2>
<p>Payne decided to focus her analysis on three specific dates (or episodes):</p>
<ul>
<li>January 8, 2016 (Pre-Brexit)</li>
<li>June 24, 2016 (Brexit)</li>
<li>December 1, 2017 (Post-Brexit)</li>
</ul>
<p>Roughly, the dates corresponded to six months ahead of the Brexit referendum, the week of the referendum, and the six months after the referendum.</p>
<p>In addition to the prices of the 25<span class="math inline">\(\Delta\)</span> options, she needed the prices of the 10<span class="math inline">\(\Delta\)</span> options. The equations below, analogous to the ones used to obtain the information from the 25<span class="math inline">\(\Delta\)</span> options, would prove handy for obtaining them:</p>
<p><span class="math display">\[
\begin{aligned}
  \sigma_{10\Delta C} &amp;= \sigma_{ATM} + BF_{10\Delta} + \frac{1}{2} RR_{10\Delta}\\
  \sigma_{10\Delta P} &amp;= \sigma_{ATM} + BF_{10\Delta} - \frac{1}{2} RR_{10\Delta}\\
  \sigma_{90\Delta C} &amp;= \sigma_{10\Delta P}
\end{aligned}
\]</span></p>
<p>Before performing the calculations Payne had to select the appropriate software. One option, which everybody at the IMF used, was Excel. One advantage was that free files were available in any dark corner in the IMF building. But there were horror stories about Excel: once was hooked on it, it was impossible to abandon it. Some of her colleagues considered it even worse than being hooked on meth. Users were saddled with the mental suffering and distress but did not experience any highs.</p>
<p><code>Matlab</code> was the other availalbe software she could use but it was very expensive. The money was better spent buying a new Honda Accord fully equipped. She decided to use <code>R</code>, a free software environment for statistical computing and graphics, with many available state-of-the-art libraries. Furthermore, the savings could go into her defined-contribution retirement plan and allow her to take the 50 option if she so desired.</p>
<div id="selecting-the-data-for-specific-dates" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Selecting the data for specific dates</h3>
<p>After begging for permission to install the non-white-listed software, Payne finally got <code>R</code> and the <code>RStudio</code> IDE running in her laptop. She ran the following commands to read the data for the specific dates she had in mind:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())                                     <span class="co"># Clean up memory</span>
filename =<span class="st"> &quot;2018_IET_Options_data.csv&quot;</span>            <span class="co"># Name of CSV data file</span>
data =<span class="st"> </span><span class="kw">read.csv</span>(filename, <span class="dt">header=</span><span class="ot">TRUE</span>)            <span class="co"># Load datafile</span>
data<span class="op">$</span>Dates =<span class="st"> </span><span class="kw">mdy_hm</span>(<span class="kw">as.character</span>(data<span class="op">$</span>Dates))     <span class="co"># convert dates to Date class</span>
<span class="kw">rownames</span>(data)=<span class="ot">NULL</span>                               <span class="co"># remove row names</span>

<span class="co"># Specify dates for analysis</span>

date01 =<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2016-01-08 UTC&quot;</span>)                 
date02 =<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2016-06-24 UTC&quot;</span>)
date03 =<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;2017-12-01 UTC&quot;</span>)

<span class="co"># Create data frame this.data</span>

this.data =<span class="st"> </span><span class="kw">rbind</span>(
  data[<span class="kw">which</span>(data<span class="op">$</span>Dates<span class="op">==</span>date01),],
  data[<span class="kw">which</span>(data<span class="op">$</span>Dates<span class="op">==</span>date02),],
  data[<span class="kw">which</span>(data<span class="op">$</span>Dates<span class="op">==</span>date03),])

<span class="co"># Delete row names and change the names of the columns</span>

<span class="kw">rownames</span>(this.data) =<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">colnames</span>(this.data) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Date&quot;</span>,<span class="st">&quot;spot&quot;</span>,<span class="st">&quot;forward&quot;</span>,<span class="st">&quot;atm&quot;</span>, <span class="st">&quot;rr25&quot;</span>,<span class="st">&quot;bf25&quot;</span>,<span class="st">&quot;rr10&quot;</span>,<span class="st">&quot;bf10&quot;</span>,<span class="st">&quot;rf&quot;</span>,<span class="st">&quot;rd&quot;</span>,<span class="st">&quot;imp_rd&quot;</span>)</code></pre></div>
</div>
<div id="calculation-of-implied-volatilities-vols" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Calculation of implied volatilities (vols)</h3>
<p>The following lines of code used the information from the risk reversals and the butterfly spreads to calculate the vols of the different calls and puts:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Vols are in percent, expressed them as simple numbers</span>
this.data<span class="op">$</span>atm  =<span class="st"> </span>this.data<span class="op">$</span>atm<span class="op">/</span><span class="dv">100</span>
this.data<span class="op">$</span>rr25 =<span class="st"> </span>this.data<span class="op">$</span>rr25<span class="op">/</span><span class="dv">100</span>
this.data<span class="op">$</span>bf25 =<span class="st"> </span>this.data<span class="op">$</span>bf25<span class="op">/</span><span class="dv">100</span>
this.data<span class="op">$</span>rr10 =<span class="st"> </span>this.data<span class="op">$</span>rr10<span class="op">/</span><span class="dv">100</span>
this.data<span class="op">$</span>bf10 =<span class="st"> </span>this.data<span class="op">$</span>bf10<span class="op">/</span><span class="dv">100</span>
this.data<span class="op">$</span>rf   =<span class="st"> </span>this.data<span class="op">$</span>rf<span class="op">/</span><span class="dv">100</span>
this.data<span class="op">$</span>rd   =<span class="st"> </span>this.data<span class="op">$</span>rd<span class="op">/</span><span class="dv">100</span>
this.data<span class="op">$</span>imp_rd=this.data<span class="op">$</span>imp_rd<span class="op">/</span><span class="dv">100</span>

<span class="co"># We will use this.data repeatedly</span>
<span class="co"># Attach it to access its elements</span>

<span class="kw">attach</span>(this.data)     

<span class="co"># Recover the vols for different deltas</span>

this.data<span class="op">$</span>sigma10c =<span class="st"> </span>atm <span class="op">+</span><span class="st"> </span>bf10 <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>rr10
this.data<span class="op">$</span>sigma25c =<span class="st"> </span>atm <span class="op">+</span><span class="st"> </span>bf25 <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>rr25
this.data<span class="op">$</span>sigma75c =<span class="st"> </span>this.data<span class="op">$</span>sigma25c <span class="op">-</span><span class="st"> </span>rr25
this.data<span class="op">$</span>sigma90c =<span class="st"> </span>this.data<span class="op">$</span>sigma10c <span class="op">-</span><span class="st"> </span>rr10
this.data<span class="op">$</span>sigmaatm =<span class="st"> </span>atm

Tenor =<span class="st"> </span><span class="dv">3</span><span class="op">/</span><span class="dv">12</span>   <span class="co"># Maturity of options, 3 months, in years</span></code></pre></div>
<p>The tenor, or time to maturity of the option, was set to <span class="math inline">\(\frac{3}{12} = 0.25\)</span> years, to be consistent with the market convention for implied volatility, which is annualized.</p>
</div>
<div id="delta_atm-depends-on-the-atm-conventions-used" class="section level3">
<h3><span class="header-section-number">3.4.3</span> <span class="math inline">\(\Delta_{ATM}\)</span> depends on the ATM conventions used</h3>
<p>So far, the only missing piece of information is the <span class="math inline">\(\Delta_{ATM}\)</span>, or the <span class="math inline">\(\Delta\)</span> associated with the <span class="math inline">\(ATM\)</span> option. “How do I calculate that number?” Payne wondered aloud. As the reader can guess, the definition of the <span class="math inline">\(ATM\)</span> option depends on what convention the market uses. There are three different conventions:</p>
<ul>
<li><p>for retail products, the <span class="math inline">\(ATM\)</span> strike is the current spot rate. In this case:<br />
<span class="math display">\[
\begin{aligned}
K_{ATM} &amp;= S\\
\Delta_{ATM} &amp;= N \left(\frac{\log(F/S) + \frac{1}{2} \sigma_{ATM}^2 T}{\sigma_{ATM} \sqrt T} \right)
\end{aligned}
\]</span></p></li>
<li><p>for emerging market currencies and/or options with maturities above one year, the <span class="math inline">\(ATM\)</span> strike is the forward rate, or the <span class="math inline">\(ATMF\)</span>. In this case: <span class="math display">\[
\begin{aligned}
K_{ATM} &amp;= F\\
\Delta_{ATM} &amp;= \exp(-Rf \times T)N(\frac{1}{2}\sigma_{ATM} \sqrt T) 
\end{aligned}
\]</span></p></li>
<li><p>for major currency pair and/or options with maturities of one year or less, the <span class="math inline">\(ATM\)</span> strike is the value of the exchange rate such that the call and the put have the same <span class="math inline">\(\Delta\)</span>. In this case, <span class="math inline">\(\Delta_{ATM} \simeq 0.5\)</span> and the strike price <span class="math inline">\(K_{ATM}\)</span> is:<br />
<span class="math display">\[
\begin{aligned}
 K_{ATM} &amp;= F \times \exp\left( 0.5 \sigma^2_{ATM}\times T \right)\\
 \Delta_{ATM} &amp;= 0.5\times exp(-Rf \times T) \simeq 0.5 
\end{aligned}
\]</span></p></li>
</ul>
<p>The pair GBP-USD required using the third market convention. Payne calculated the strike of the <span class="math inline">\(ATM\)</span> option and its <span class="math inline">\(\Delta\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate the strike of the ATM option</span>
K_atm =<span class="st"> </span>forward<span class="op">*</span><span class="kw">exp</span>((<span class="fl">0.5</span><span class="op">*</span>(this.data<span class="op">$</span>sigmaatm)<span class="op">^</span><span class="dv">2</span>)<span class="op">*</span>Tenor)
deltaATM =<span class="st"> </span><span class="fl">0.5</span><span class="op">*</span><span class="kw">exp</span>(<span class="op">-</span>rf<span class="op">*</span>Tenor)</code></pre></div>
</div>
<div id="a-rough-first-pass-on-the-volatility-smile" class="section level3">
<h3><span class="header-section-number">3.4.4</span> A rough first pass on the volatility smile</h3>
<p>In the case of the GBPUSD, the <span class="math inline">\(\Delta_{ATM}\)</span> could be very well approximated by <span class="math inline">\(0.5\)</span>. To check the data, Payne decided to plot of the volatility smile. First, she created the data frame with the information the plot required:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Select only the vols for each delta</span>
list_variables =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;sigma10c&quot;</span>, <span class="st">&quot;sigma25c&quot;</span>, <span class="st">&quot;sigmaatm&quot;</span>, <span class="st">&quot;sigma75c&quot;</span>, <span class="st">&quot;sigma90c&quot;</span>)

<span class="co"># Read the data as a matrix</span>
vol_data =<span class="st"> </span><span class="kw">t</span>(<span class="kw">as.matrix</span>(<span class="kw">subset</span>(this.data, <span class="dt">select=</span>list_variables)))

<span class="co"># Group the deltas in a vector, to be used in the x-axis</span>
delta_vector =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>)

<span class="co"># Create the data frame for the chart</span>
vol.smile  =<span class="st"> </span><span class="kw">data.frame</span>(delta_vector, vol_data)   
<span class="kw">rownames</span>(vol.smile) =<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">colnames</span>(vol.smile) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Delta&quot;</span>,<span class="st">&quot;PreBrexit&quot;</span>,<span class="st">&quot;Brexit&quot;</span>,<span class="st">&quot;PostBrexit&quot;</span>)</code></pre></div>
<p>and used <code>ggplot</code> to create the chart:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reshape2)
vol.data =<span class="st"> </span><span class="kw">melt</span>(vol.smile, <span class="dt">id=</span><span class="st">&quot;Delta&quot;</span>)
<span class="kw">ggplot</span>(<span class="dt">data=</span>vol.data, <span class="kw">aes</span>(<span class="dt">x=</span>Delta, <span class="dt">y=</span>value, <span class="dt">shape=</span>variable)) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour=</span>variable), <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">   </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;vol&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-33"></span>
<img src="images/unnamed-chunk-33-1.png" alt="Rough volatility smiles" width="100%" />
<p class="caption">
Figure 3.5: Rough volatility smiles
</p>
</div>
</div>
<div id="a-more-refined-approximation-of-the-volatility-smile" class="section level3">
<h3><span class="header-section-number">3.4.5</span> A more refined approximation of the volatility smile</h3>
<p>It is possible to extend the volatility smile over a wider range of <span class="math inline">\(\Delta\)</span> values using a polynomial approximation of second degree. The function <code>fit.Vol()</code> in the <code>auxFile.R</code> takes as input the observed vols and their corresponding <span class="math inline">\(\Delta\)</span>s, and interpolates and extrapolates the vols for a wider range of <span class="math inline">\(\Delta\)</span> values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Function fit.vol fits a polynomial of second degree to the volatility smile</span>
fit.Vol =<span class="st"> </span><span class="cf">function</span>(data.vol, data.delta,delta.range)
{
  poly.fit =<span class="st"> </span><span class="kw">lm</span>(data.vol <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(data.delta, <span class="dv">2</span>, <span class="dt">raw=</span><span class="ot">TRUE</span>))  

  <span class="co"># Use fitted polynomial to interpolate Delta-Vol Curve</span>
  delta.square =<span class="st"> </span>delta.range<span class="op">*</span>delta.range
  delta.interc =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>,<span class="kw">length</span>(delta.range))
  
  X =<span class="st"> </span><span class="kw">cbind</span>(delta.interc, delta.range, delta.square)
  iVolInterpol =<span class="st"> </span><span class="kw">t</span>(<span class="kw">t</span>(X)<span class="op">*</span>poly.fit<span class="op">$</span>coefficients)
  iVolInterpol =<span class="st"> </span><span class="kw">rowSums</span>(iVolInterpol)

  <span class="kw">return</span>(iVolInterpol)
}</code></pre></div>
<p>Payne used the <code>fitVol()</code> function to fit the volatility smile for the pre-Brexit, Brexit, and post-Brexit dates:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get the data points from the vol.smile data frame</span>
data.delta =<span class="st"> </span>vol.smile<span class="op">$</span>Delta
data.vol  =<span class="st"> </span>vol.smile<span class="op">$</span>PreBrexit

<span class="co"># Interpolation and extrapolation range</span>
delta.range =<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from=</span><span class="fl">0.01</span>, <span class="dt">to =</span> <span class="fl">0.99</span>, <span class="dt">by=</span><span class="fl">0.005</span>)

<span class="co"># Obtain the volatility smiles</span>
smile.preBrexit =<span class="st"> </span><span class="kw">fit.Vol</span>(vol.smile<span class="op">$</span>PreBrexit, data.delta, delta.range)
smile.Brexit    =<span class="st"> </span><span class="kw">fit.Vol</span>(vol.smile<span class="op">$</span>Brexit, data.delta, delta.range)
smile.postBrexit =<span class="st"> </span><span class="kw">fit.Vol</span>(vol.smile<span class="op">$</span>PostBrexit, data.delta, delta.range)

<span class="co"># Group the extended volatility smiles in a data frame</span>
smile.df =<span class="st"> </span><span class="kw">data.frame</span>(delta.range, smile.preBrexit, smile.Brexit, smile.postBrexit)
<span class="kw">rownames</span>(smile.df) =<span class="st"> </span><span class="ot">NULL</span>
<span class="kw">colnames</span>(smile.df) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Delta&quot;</span>,<span class="st">&quot;preBrexit&quot;</span>,<span class="st">&quot;Brexit&quot;</span>, <span class="st">&quot;postBrexit&quot;</span>)

<span class="co"># Create the chart</span>
<span class="kw">library</span>(reshape2)
smile.data =<span class="st"> </span><span class="kw">melt</span>(smile.df, <span class="dt">id=</span><span class="st">&quot;Delta&quot;</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> smile.data, <span class="kw">aes</span>(<span class="dt">x=</span>Delta, <span class="dt">y=</span>value, <span class="dt">colour=</span>variable)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;vol&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-35"></span>
<img src="images/unnamed-chunk-35-1.png" alt="Fitted volatility smiles" width="100%" />
<p class="caption">
Figure 3.6: Fitted volatility smiles
</p>
</div>
<p>Before going further in her analysis, Payne asked herself a question:</p>
<div style="width:auto; height:auto; padding-top:5px; 
padding-bottom:5px; padding-left:20px; padding-right:20px; font-size:90%; border:1px solid black">
<p>Question: In the week of the Brexit referendum, does it make sense that higher <span class="math inline">\(\Delta\)</span>s have higher implied volatility values?</p>
</div>

</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="3-3-curvature.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="4-extracting-the-risk-neutral-density.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
